<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>H!P QnAs Searcher</title>
    <link rel="icon" type="image/png" href="favicon-32x32.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">


    <style>
        table {
            width: 100%;
        }

        th,
        td {
            border: 1px solid #dddddd;
            text-align: left;
            padding: 8px;
            font-size: 0.9em;
            
        }
        

        .idolName {
            width: 30%;

        }

        .idolQ {
            width: 35%;
        }

        .idolA {
            width: 35%;
        }

        .searchPart {
            margin-bottom: 20px;
        }
        .title{
            font-size: 2.2rem;  
            text-shadow: 1px 1px rgb(116, 114, 114);
        }
    </style>
    <script src="qnas.js"></script>
    <script src="flexsearch.compact.js"></script>
</head>

<body class="bg-dark text-light ">


    <main class="container">
        <section class="searchPart">
            <h2 class="text-center title">H!P QnAs Searcher</h2>

            <h3>Search</h3>
            Text: <input id="searchInput" type="text" name="" id="" autocomplete="off">

            In <select name="tablesOptions" id="tablesOptions">
                <option value="all" selected="selected">All</option>
                <option value="info">Name and Info</option>
                <option value="q">Questions</option>
                <option value="a">Answers</option>
            </select>

        </section>

        <section id="cardsPlace">

        </section>
    </main>


    <script>
        qnas = qnas.flat();
        const maxAnswers = 30;

        var index = new FlexSearch({

            encode: "balance",
            tokenize: "reverse",
            suggest: true,
            cache: true,
            autocomplete: false
        });


        for (var i = 0; i < qnas.length; i++) {
            if (qnas[i]) {
                index.add(i, `${qnas[i].name}  ${qnas[i].group} ${qnas[i].date} ${qnas[i].id} ${qnas[i].q} ${qnas[i].a}`);
            } else {
              //  console.log(qnas[i - 1], i)
            }

        }


        let searchInput = document.getElementById("searchInput");
        let cardsPlace = document.getElementById("cardsPlace");

        searchInput.addEventListener("input", function () {

            showSuggestions();
        });
        function showSuggestions(randomIndexArr) {
            cardsPlace.innerHTML = "Loading..."
            cardsPlace.innerHTML = "";
            let arrIndex;
            if (!randomIndexArr) {
                arrIndex = index.search(searchInput.value, maxAnswers);
            } else {
                arrIndex = randomIndexArr;
            }

            let results = "";
            for (let i of arrIndex) {


                results += `
                <tr>
                    <td class="idolName">
                    ${qnas[i].name} <br> - <br> ${qnas[i].group} <br> - <br>  ${qnas[i].date} <a href="http://www.hello-online.org/index.php?app=helloapp&amp;CODE=article&amp;topic=${qnas[i].id}">H!O</a> </td>
               
                    <td  class="idolQ">${(qnas[i].q)}</td>
                    <td class="idolA">${qnas[i].a.join("<br>")}</td>
                </tr>`



            }
            let section = document.createElement("section");
            section.innerHTML = `<section class="container bg-dark ">
        <div class="card text-center bg-dark border-white">
            <div id="containerTable">
                <table id="tableProducts">
                    <tr>
                        <th class="idolName">Name and Info</th>

                        <th  class="idolQ">Question</th>
                        <th class="idolA">Answer</th>

                    </tr>
                    ${results}
                </table>

            </div>
        </div>
    </section>`
            cardsPlace.appendChild(section);
        }



        let tablesOptions = document.getElementById("tablesOptions");
        tablesOptions.options[0].selected = true;
        tablesOptions.addEventListener("change", function () {
            //console.log("change");
            let value = tablesOptions.options[tablesOptions.selectedIndex].value;
            //console.log(value)
            if (value === "info") {
                index.clear();
                for (var i = 0; i < qnas.length; i++) {
                    index.add(i, `${qnas[i].name}  ${qnas[i].group} ${qnas[i].date} ${qnas[i].id}`);
                }

            } else if (value === "q") {
                index.clear();
                for (var i = 0; i < qnas.length; i++) {
                    index.add(i, `${qnas[i].q}`);
                }

            } else if (value === "a") {
                index.clear();
                for (var i = 0; i < qnas.length; i++) {
                    index.add(i, `${qnas[i].a}`);
                }

            } else if (value === "all") {
                index.clear();
                for (var i = 0; i < qnas.length; i++) {
                    index.add(i, `${qnas[i].name}  ${qnas[i].group} ${qnas[i].date} ${qnas[i].id} ${qnas[i].q} ${qnas[i].a}`);
                }
            }
            showSuggestions();
        });
    </script>


    <script>


        function ids() {
            let idsSet = new Set();

            qnas.forEach(element => {
                idsSet.add(element["id"]);
            });
          //  console.log([...idsSet].sort((a, b) => a - b));
        }

        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min) + min); //The maximum is exclusive and the minimum is inclusive
        }


        let len = qnas.length;
        let randomArr = [];
        for (let i = 0; i < 10; i++) {
            randomArr.push(getRandomInt(0, len))
        }
        showSuggestions(randomArr)

    </script>



</body>

</html>
